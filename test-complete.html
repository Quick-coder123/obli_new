<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–º–ø–ª–µ–∫—Å–Ω–∏–π —Ç–µ—Å—Ç —Å–∏—Å—Ç–µ–º–∏ –∫–∞—Ä—Ç–æ–∫</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold mb-6 text-center">üß™ –ö–æ–º–ø–ª–µ–∫—Å–Ω–∏–π —Ç–µ—Å—Ç —Å–∏—Å—Ç–µ–º–∏ –∫–∞—Ä—Ç–æ–∫</h1>
        
        <!-- –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º–∏ -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º–∏</h2>
            <div id="systemStatus" class="text-gray-500">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–∏—Å—Ç–µ–º—É"</div>
            <button id="checkSystem" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–∏—Å—Ç–µ–º—É
            </button>
        </div>

        <!-- –¢–µ—Å—Ç–∏ -->
        <div class="grid md:grid-cols-2 gap-6">
            <!-- –¢–µ—Å—Ç 1: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏ -->
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold mb-4">üÜï –¢–µ—Å—Ç 1: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏</h3>
                <button id="test1" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 mb-4">
                    –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤—É –∫–∞—Ä—Ç–∫—É
                </button>
                <div id="test1Result" class="text-sm"></div>
            </div>

            <!-- –¢–µ—Å—Ç 2: –ê—Ä—Ö—ñ–≤—É–≤–∞–Ω–Ω—è -->
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold mb-4">üì¶ –¢–µ—Å—Ç 2: –ê—Ä—Ö—ñ–≤—É–≤–∞–Ω–Ω—è</h3>
                <button id="test2" class="bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600 mb-4">
                    –¢–µ—Å—Ç –∞–≤—Ç–æ–∞—Ä—Ö—ñ–≤—É–≤–∞–Ω–Ω—è
                </button>
                <div id="test2Result" class="text-sm"></div>
            </div>

            <!-- –¢–µ—Å—Ç 3: –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∞—Ä—Ö—ñ–≤—É -->
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold mb-4">‚úèÔ∏è –¢–µ—Å—Ç 3: –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∞—Ä—Ö—ñ–≤—É</h3>
                <button id="test3" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 mb-4">
                    –¢–µ—Å—Ç —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∞—Ä—Ö—ñ–≤—É
                </button>
                <div id="test3Result" class="text-sm"></div>
            </div>

            <!-- –¢–µ—Å—Ç 4: –ü–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è –∑ –∞—Ä—Ö—ñ–≤—É -->
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold mb-4">üîÑ –¢–µ—Å—Ç 4: –ü–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è –∑ –∞—Ä—Ö—ñ–≤—É</h3>
                <button id="test4" class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600 mb-4">
                    –¢–µ—Å—Ç –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è –∑ –∞—Ä—Ö—ñ–≤—É
                </button>
                <div id="test4Result" class="text-sm"></div>
            </div>

            <!-- –¢–µ—Å—Ç 5: –í–∏–¥–∞–ª–µ–Ω–Ω—è -->
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold mb-4">üóëÔ∏è –¢–µ—Å—Ç 5: –í–∏–¥–∞–ª–µ–Ω–Ω—è</h3>
                <button id="test5" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 mb-4">
                    –¢–µ—Å—Ç –≤–∏–¥–∞–ª–µ–Ω–Ω—è
                </button>
                <div id="test5Result" class="text-sm"></div>
            </div>

            <!-- –û—á–∏—â–µ–Ω–Ω—è -->
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold mb-4">üßπ –û—á–∏—â–µ–Ω–Ω—è</h3>
                <button id="cleanup" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 mb-4">
                    –û—á–∏—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ
                </button>
                <div id="cleanupResult" class="text-sm"></div>
            </div>
        </div>

        <!-- –õ–æ–≥–∏ -->
        <div class="bg-black text-green-400 rounded-lg shadow p-6 mt-6">
            <h3 class="text-lg font-semibold mb-4">üìã –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º–∏</h3>
            <div id="logs" class="font-mono text-sm max-h-96 overflow-y-auto whitespace-pre-wrap"></div>
            <button id="clearLogs" class="mt-4 bg-gray-600 text-white px-3 py-1 rounded text-sm">
                –û—á–∏—Å—Ç–∏—Ç–∏ –ª–æ–≥–∏
            </button>
        </div>
    </div>

    <script src="supabaseConfig.js"></script>
    <script src="dataService.js"></script>
    
    <script>
        const dataServiceInstance = new DataService();
        let testCards = [];
        
        // –õ–æ–≥—É–≤–∞–Ω–Ω—è
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('uk-UA');
            const logDiv = document.getElementById('logs');
            const typeEmoji = {
                'info': '‚ÑπÔ∏è',
                'success': '‚úÖ',
                'error': '‚ùå',
                'warning': '‚ö†Ô∏è'
            };
            logDiv.textContent += `[${timestamp}] ${typeEmoji[type]} ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // –ü–æ–∫–∞–∑–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç—É
        function showResult(elementId, message, isSuccess = true) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="p-3 rounded ${isSuccess ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">${message}</div>`;
        }

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º–∏
        document.getElementById('checkSystem').addEventListener('click', async () => {
            const statusDiv = document.getElementById('systemStatus');
            statusDiv.innerHTML = '<p class="text-blue-600">üîÑ –ü–µ—Ä–µ–≤—ñ—Ä—è—é —Å–∏—Å—Ç–µ–º—É...</p>';
            log('–ü–æ—á–∞—Ç–æ–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å–∏—Å—Ç–µ–º–∏...');
            
            try {
                await dataServiceInstance.initialize();
                log('DataService —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ', 'success');
                
                // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—å
                const cards = await dataServiceInstance.getCards();
                const archivedCards = await dataServiceInstance.getArchivedCards();
                
                log(`–ó–Ω–∞–π–¥–µ–Ω–æ –∞–∫—Ç–∏–≤–Ω–∏—Ö –∫–∞—Ä—Ç–æ–∫: ${cards.length}`, 'success');
                log(`–ó–Ω–∞–π–¥–µ–Ω–æ –∞—Ä—Ö—ñ–≤–Ω–∏—Ö –∫–∞—Ä—Ç–æ–∫: ${archivedCards.length}`, 'success');
                
                statusDiv.innerHTML = `
                    <div class="text-green-600">
                        <p>‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞—Ü—é—î –Ω–æ—Ä–º–∞–ª—å–Ω–æ!</p>
                        <p>üìä –ê–∫—Ç–∏–≤–Ω–∏—Ö –∫–∞—Ä—Ç–æ–∫: ${cards.length}</p>
                        <p>üì¶ –ê—Ä—Ö—ñ–≤–Ω–∏—Ö –∫–∞—Ä—Ç–æ–∫: ${archivedCards.length}</p>
                        <p>üîó Supabase –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ: ${dataServiceInstance.supabaseReady ? '‚úÖ' : '‚ùå'}</p>
                    </div>
                `;
            } catch (error) {
                log(`–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å–∏—Å—Ç–µ–º–∏: ${error.message}`, 'error');
                statusDiv.innerHTML = `<p class="text-red-600">‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}</p>`;
            }
        });

        // –¢–µ—Å—Ç 1: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏
        document.getElementById('test1').addEventListener('click', async () => {
            log('=== –¢–ï–°–¢ 1: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏ ===');
            
            try {
                await dataServiceInstance.initialize();
                
                const testCard = {
                    fullName: `–¢–µ—Å—Ç –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á ${Date.now()}`,
                    ipn: '1234567890',
                    organization: '–¢–µ—Å—Ç–æ–≤–∞ –û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è',
                    accountOpenDate: '2025-07-01',
                    firstDepositDate: null, // –°–ø–æ—á–∞—Ç–∫—É –Ω–µ–∞–∫—Ç–∏–≤–Ω–∏–π
                    cardStatus: '–í–∏–≥–æ—Ç–æ–≤–ª—è—î—Ç—å—Å—è',
                    comment: '–¢–µ—Å—Ç–æ–≤–∞ –∫–∞—Ä—Ç–∫–∞',
                    documents: {
                        contract: false,
                        survey: false,
                        passport: false
                    }
                };
                
                const createdCard = await dataServiceInstance.addCard(testCard);
                testCards.push(createdCard);
                
                log(`–ö–∞—Ä—Ç–∫—É —Å—Ç–≤–æ—Ä–µ–Ω–æ: ${createdCard.fullName} (ID: ${createdCard.id})`, 'success');
                showResult('test1Result', `‚úÖ –ö–∞—Ä—Ç–∫—É —Å—Ç–≤–æ—Ä–µ–Ω–æ: ${createdCard.fullName}<br>ID: ${createdCard.id}<br>–°—Ç–∞—Ç—É—Å: ${createdCard.accountStatus}`);
                
            } catch (error) {
                log(`–ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏: ${error.message}`, 'error');
                showResult('test1Result', `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, false);
            }
        });

        // –¢–µ—Å—Ç 2: –ê—Ä—Ö—ñ–≤—É–≤–∞–Ω–Ω—è
        document.getElementById('test2').addEventListener('click', async () => {
            log('=== –¢–ï–°–¢ 2: –ê—Ä—Ö—ñ–≤—É–≤–∞–Ω–Ω—è ===');
            
            if (testCards.length === 0) {
                showResult('test2Result', '‚ö†Ô∏è –°–ø–æ—á–∞—Ç–∫—É —Å—Ç–≤–æ—Ä—ñ—Ç—å —Ç–µ—Å—Ç–æ–≤—É –∫–∞—Ä—Ç–∫—É', false);
                return;
            }
            
            try {
                // –ü—ñ–¥–≥–æ—Ç–æ–≤–ª—è—î–º–æ –∫–∞—Ä—Ç–∫—É –¥–ª—è –∞—Ä—Ö—ñ–≤—É–≤–∞–Ω–Ω—è
                const card = testCards[testCards.length - 1];
                const updatedCard = {
                    ...card,
                    firstDepositDate: '2025-07-25', // –ê–∫—Ç–∏–≤—É—î–º–æ
                    cardStatus: '–í–∏–¥–∞–Ω–æ', // –ó–º—ñ–Ω—é—î–º–æ —Å—Ç–∞—Ç—É—Å
                    documents: {
                        contract: true,
                        survey: true,
                        passport: true
                    }
                };
                
                // –û–Ω–æ–≤–ª—é—î–º–æ –∫–∞—Ä—Ç–∫—É
                await dataServiceInstance.updateCard(card.id, updatedCard);
                log(`–ö–∞—Ä—Ç–∫—É –æ–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è –∞—Ä—Ö—ñ–≤—É–≤–∞–Ω–Ω—è: ${card.fullName}`, 'success');
                
                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —É–º–æ–≤–∏ –∞—Ä—Ö—ñ–≤—É–≤–∞–Ω–Ω—è
                const shouldArchive = 
                    updatedCard.accountStatus === '–ê–∫—Ç–∏–≤–Ω–∏–π' &&
                    updatedCard.cardStatus === '–í–∏–¥–∞–Ω–æ' &&
                    updatedCard.documents?.contract === true &&
                    updatedCard.documents?.survey === true &&
                    updatedCard.documents?.passport === true;
                
                log(`–£–º–æ–≤–∏ –∞—Ä—Ö—ñ–≤—É–≤–∞–Ω–Ω—è: ${shouldArchive ? '–≤–∏–∫–æ–Ω–∞–Ω—ñ' : '–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω—ñ'}`, shouldArchive ? 'success' : 'warning');
                
                if (shouldArchive) {
                    // –ü–µ—Ä–µ–º—ñ—â—É—î–º–æ –≤ –∞—Ä—Ö—ñ–≤
                    await dataServiceInstance.moveToArchive(updatedCard);
                    log(`–ö–∞—Ä—Ç–∫—É –ø–µ—Ä–µ–º—ñ—â–µ–Ω–æ –≤ –∞—Ä—Ö—ñ–≤: ${updatedCard.fullName}`, 'success');
                    showResult('test2Result', `‚úÖ –ö–∞—Ä—Ç–∫—É —É—Å–ø—ñ—à–Ω–æ –∞—Ä—Ö—ñ–≤–æ–≤–∞–Ω–æ: ${updatedCard.fullName}`);
                } else {
                    showResult('test2Result', '‚ö†Ô∏è –ö–∞—Ä—Ç–∫–∞ –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —É–º–æ–≤–∞–º –∞—Ä—Ö—ñ–≤—É–≤–∞–Ω–Ω—è', false);
                }
                
            } catch (error) {
                log(`–ü–æ–º–∏–ª–∫–∞ –∞—Ä—Ö—ñ–≤—É–≤–∞–Ω–Ω—è: ${error.message}`, 'error');
                showResult('test2Result', `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, false);
            }
        });

        // –¢–µ—Å—Ç 3: –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∞—Ä—Ö—ñ–≤—É
        document.getElementById('test3').addEventListener('click', async () => {
            log('=== –¢–ï–°–¢ 3: –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∞—Ä—Ö—ñ–≤—É ===');
            
            try {
                const archivedCards = await dataServiceInstance.getArchivedCards();
                
                if (archivedCards.length === 0) {
                    showResult('test3Result', '‚ö†Ô∏è –ù–µ–º–∞—î –∫–∞—Ä—Ç–æ–∫ –≤ –∞—Ä—Ö—ñ–≤—ñ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è', false);
                    return;
                }
                
                const card = archivedCards[0];
                const updatedData = {
                    ...card,
                    comment: `–û–Ω–æ–≤–ª–µ–Ω–æ ${new Date().toLocaleTimeString('uk-UA')}`,
                    documents: {
                        contract: false, // –ó–º—ñ–Ω—é—î–º–æ –¥–æ–∫—É–º–µ–Ω—Ç
                        survey: card.documents?.survey || false,
                        passport: card.documents?.passport || false
                    }
                };
                
                const updatedCard = await dataServiceInstance.updateArchivedCard(card.id, updatedData);
                log(`–ê—Ä—Ö—ñ–≤–Ω—É –∫–∞—Ä—Ç–∫—É –æ–Ω–æ–≤–ª–µ–Ω–æ: ${updatedCard.fullName}`, 'success');
                
                showResult('test3Result', `‚úÖ –ê—Ä—Ö—ñ–≤–Ω—É –∫–∞—Ä—Ç–∫—É –æ–Ω–æ–≤–ª–µ–Ω–æ: ${updatedCard.fullName}<br>–ù–æ–≤–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: ${updatedCard.comment}`);
                
            } catch (error) {
                log(`–ü–æ–º–∏–ª–∫–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∞—Ä—Ö—ñ–≤—É: ${error.message}`, 'error');
                showResult('test3Result', `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, false);
            }
        });

        // –¢–µ—Å—Ç 4: –ü–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è –∑ –∞—Ä—Ö—ñ–≤—É
        document.getElementById('test4').addEventListener('click', async () => {
            log('=== –¢–ï–°–¢ 4: –ü–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è –∑ –∞—Ä—Ö—ñ–≤—É ===');
            
            try {
                const archivedCards = await dataServiceInstance.getArchivedCards();
                
                if (archivedCards.length === 0) {
                    showResult('test4Result', '‚ö†Ô∏è –ù–µ–º–∞—î –∫–∞—Ä—Ç–æ–∫ –≤ –∞—Ä—Ö—ñ–≤—ñ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è', false);
                    return;
                }
                
                const card = archivedCards[0];
                log(`–ü–µ—Ä–µ–º—ñ—â—É—î–º–æ –∑ –∞—Ä—Ö—ñ–≤—É: ${card.fullName}`, 'info');
                
                // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤—É –∞–∫—Ç–∏–≤–Ω—É –∫–∞—Ä—Ç–∫—É (–±–µ–∑ ID –∞—Ä—Ö—ñ–≤–Ω–æ—ó)
                const activeCard = {
                    fullName: card.fullName,
                    ipn: card.ipn,
                    organization: card.organization,
                    accountOpenDate: card.accountOpenDate,
                    firstDepositDate: card.firstDepositDate,
                    cardStatus: card.cardStatus,
                    comment: card.comment + ' (–ø–µ—Ä–µ–º—ñ—â–µ–Ω–∞ –∑ –∞—Ä—Ö—ñ–≤—É)',
                    documents: card.documents,
                    accountStatus: card.accountStatus,
                    createdAt: card.createdAt,
                    updatedAt: new Date().toISOString()
                };
                
                // –î–æ–¥–∞—î–º–æ –≤ –∞–∫—Ç–∏–≤–Ω—ñ
                const newActiveCard = await dataServiceInstance.addCard(activeCard);
                log(`–ö–∞—Ä—Ç–∫—É –¥–æ–¥–∞–Ω–æ –≤ –∞–∫—Ç–∏–≤–Ω—ñ: ${newActiveCard.fullName}`, 'success');
                
                // –í–∏–¥–∞–ª—è—î–º–æ –∑ –∞—Ä—Ö—ñ–≤—É
                await dataServiceInstance.deleteArchivedCard(card.id);
                log(`–ö–∞—Ä—Ç–∫—É –≤–∏–¥–∞–ª–µ–Ω–æ –∑ –∞—Ä—Ö—ñ–≤—É: ${card.fullName}`, 'success');
                
                showResult('test4Result', `‚úÖ –ö–∞—Ä—Ç–∫—É –ø–µ—Ä–µ–º—ñ—â–µ–Ω–æ –∑ –∞—Ä—Ö—ñ–≤—É: ${card.fullName}<br>–ù–æ–≤–∏–π ID: ${newActiveCard.id}`);
                
            } catch (error) {
                log(`–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è –∑ –∞—Ä—Ö—ñ–≤—É: ${error.message}`, 'error');
                showResult('test4Result', `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, false);
            }
        });

        // –¢–µ—Å—Ç 5: –í–∏–¥–∞–ª–µ–Ω–Ω—è
        document.getElementById('test5').addEventListener('click', async () => {
            log('=== –¢–ï–°–¢ 5: –í–∏–¥–∞–ª–µ–Ω–Ω—è ===');
            
            try {
                const cards = await dataServiceInstance.getCards();
                const archivedCards = await dataServiceInstance.getArchivedCards();
                
                let deleted = 0;
                
                // –í–∏–¥–∞–ª—è—î–º–æ —Ç–µ—Å—Ç–æ–≤—ñ –∞–∫—Ç–∏–≤–Ω—ñ –∫–∞—Ä—Ç–∫–∏
                for (const card of cards) {
                    if (card.fullName.includes('–¢–µ—Å—Ç')) {
                        await dataServiceInstance.deleteCard(card.id);
                        log(`–í–∏–¥–∞–ª–µ–Ω–æ –∞–∫—Ç–∏–≤–Ω—É –∫–∞—Ä—Ç–∫—É: ${card.fullName}`, 'success');
                        deleted++;
                    }
                }
                
                // –í–∏–¥–∞–ª—è—î–º–æ —Ç–µ—Å—Ç–æ–≤—ñ –∞—Ä—Ö—ñ–≤–Ω—ñ –∫–∞—Ä—Ç–∫–∏
                for (const card of archivedCards) {
                    if (card.fullName.includes('–¢–µ—Å—Ç')) {
                        await dataServiceInstance.deleteArchivedCard(card.id);
                        log(`–í–∏–¥–∞–ª–µ–Ω–æ –∞—Ä—Ö—ñ–≤–Ω—É –∫–∞—Ä—Ç–∫—É: ${card.fullName}`, 'success');
                        deleted++;
                    }
                }
                
                showResult('test5Result', `‚úÖ –í–∏–¥–∞–ª–µ–Ω–æ ${deleted} —Ç–µ—Å—Ç–æ–≤–∏—Ö –∫–∞—Ä—Ç–æ–∫`);
                testCards = [];
                
            } catch (error) {
                log(`–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è: ${error.message}`, 'error');
                showResult('test5Result', `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, false);
            }
        });

        // –û—á–∏—â–µ–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö
        document.getElementById('cleanup').addEventListener('click', async () => {
            log('=== –û–ß–ò–©–ï–ù–ù–Ø –¢–ï–°–¢–û–í–ò–• –î–ê–ù–ò–• ===');
            
            try {
                const cards = await dataServiceInstance.getCards();
                const archivedCards = await dataServiceInstance.getArchivedCards();
                
                let cleaned = 0;
                
                // –û—á–∏—â–∞—î–º–æ –∞–∫—Ç–∏–≤–Ω—ñ —Ç–µ—Å—Ç–æ–≤—ñ –∫–∞—Ä—Ç–∫–∏
                for (const card of cards) {
                    if (card.fullName.includes('–¢–µ—Å—Ç') || card.organization === '–¢–µ—Å—Ç–æ–≤–∞ –û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è') {
                        await dataServiceInstance.deleteCard(card.id);
                        cleaned++;
                    }
                }
                
                // –û—á–∏—â–∞—î–º–æ –∞—Ä—Ö—ñ–≤–Ω—ñ —Ç–µ—Å—Ç–æ–≤—ñ –∫–∞—Ä—Ç–∫–∏
                for (const card of archivedCards) {
                    if (card.fullName.includes('–¢–µ—Å—Ç') || card.organization === '–¢–µ—Å—Ç–æ–≤–∞ –û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è') {
                        await dataServiceInstance.deleteArchivedCard(card.id);
                        cleaned++;
                    }
                }
                
                testCards = [];
                log(`–û—á–∏—â–µ–Ω–æ ${cleaned} —Ç–µ—Å—Ç–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤`, 'success');
                showResult('cleanupResult', `‚úÖ –û—á–∏—â–µ–Ω–æ ${cleaned} —Ç–µ—Å—Ç–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤`);
                
            } catch (error) {
                log(`–ü–æ–º–∏–ª–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è: ${error.message}`, 'error');
                showResult('cleanupResult', `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, false);
            }
        });

        // –û—á–∏—Å—Ç–∏—Ç–∏ –ª–æ–≥–∏
        document.getElementById('clearLogs').addEventListener('click', () => {
            document.getElementById('logs').textContent = '';
        });

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        document.addEventListener('DOMContentLoaded', () => {
            log('–°—Ç–æ—Ä—ñ–Ω–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞, –≥–æ—Ç–æ–≤–∏–π –¥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è', 'info');
        });
    </script>
</body>
</html>
