<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–®–≤–∏–¥–∫–∏–π —Ç–µ—Å—Ç —Å–∏—Å—Ç–µ–º–∏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-2xl font-bold mb-6">üöÄ –®–≤–∏–¥–∫–∏–π —Ç–µ—Å—Ç —Å–∏—Å—Ç–µ–º–∏</h1>
        
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-lg font-semibold mb-4">üìä –°—Ç–∞—Ç—É—Å</h2>
            <div id="status" class="text-gray-500">–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è...</div>
        </div>

        <div class="grid md:grid-cols-3 gap-4">
            <button id="testBasic" class="bg-blue-500 text-white p-4 rounded hover:bg-blue-600">
                üîß –¢–µ—Å—Ç –æ—Å–Ω–æ–≤–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π
            </button>
            <button id="testArchive" class="bg-green-500 text-white p-4 rounded hover:bg-green-600">
                üì¶ –¢–µ—Å—Ç –∞—Ä—Ö—ñ–≤—É
            </button>
            <button id="testCleanup" class="bg-red-500 text-white p-4 rounded hover:bg-red-600">
                üßπ –û—á–∏—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ
            </button>
        </div>

        <div class="bg-black text-green-400 rounded-lg p-4 mt-6">
            <h3 class="font-semibold mb-2">üìã –õ–æ–≥–∏:</h3>
            <pre id="logs" class="text-sm max-h-96 overflow-y-auto"></pre>
        </div>
    </div>

    <script src="supabaseConfig.js"></script>
    <script src="dataService.js"></script>
    
    <script>
        let dataService;
        let logs = [];

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            logs.push(logMessage);
            document.getElementById('logs').textContent = logs.join('\n');
            console.log(logMessage);
        }

        async function init() {
            try {
                dataService = new DataService();
                await dataService.initialize();
                log('‚úÖ DataService —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ');
                
                const cards = await dataService.getCards();
                const archived = await dataService.getArchivedCards();
                
                document.getElementById('status').innerHTML = `
                    <div class="text-green-600">
                        <p>‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞—Ü—é—î</p>
                        <p>–ê–∫—Ç–∏–≤–Ω–∏—Ö –∫–∞—Ä—Ç–æ–∫: ${cards.length}</p>
                        <p>–ê—Ä—Ö—ñ–≤–Ω–∏—Ö –∫–∞—Ä—Ç–æ–∫: ${archived.length}</p>
                    </div>
                `;
                log(`üìä –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ: ${cards.length} –∞–∫—Ç–∏–≤–Ω–∏—Ö, ${archived.length} –∞—Ä—Ö—ñ–≤–Ω–∏—Ö –∫–∞—Ä—Ç–æ–∫`);
                
            } catch (error) {
                log(`‚ùå –ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó: ${error.message}`);
                document.getElementById('status').innerHTML = `<p class="text-red-600">‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}</p>`;
            }
        }

        document.getElementById('testBasic').addEventListener('click', async () => {
            log('=== –¢–ï–°–¢ –û–°–ù–û–í–ù–ò–• –§–£–ù–ö–¶–Ü–ô ===');
            
            try {
                // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏
                const testCard = {
                    fullName: `–®–≤–∏–¥–∫–∏–π –¢–µ—Å—Ç ${Date.now()}`,
                    ipn: '9876543210',
                    organization: '–®–≤–∏–¥–∫–∏–π –¢–µ—Å—Ç –û—Ä–≥',
                    accountOpenDate: '2025-07-01',
                    firstDepositDate: null,
                    cardStatus: '–í–∏–≥–æ—Ç–æ–≤–ª—è—î—Ç—å—Å—è',
                    comment: '–®–≤–∏–¥–∫–∏–π —Ç–µ—Å—Ç',
                    documents: { contract: false, survey: false, passport: false }
                };
                
                const created = await dataService.addCard(testCard);
                log(`‚úÖ –ö–∞—Ä—Ç–∫—É —Å—Ç–≤–æ—Ä–µ–Ω–æ: ${created.fullName} (${created.id})`);
                
                // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏
                const updated = await dataService.updateCard(created.id, {
                    ...created,
                    comment: '–û–Ω–æ–≤–ª–µ–Ω–æ –≤ —à–≤–∏–¥–∫–æ–º—É —Ç–µ—Å—Ç—ñ',
                    firstDepositDate: '2025-07-25'
                });
                log(`‚úÖ –ö–∞—Ä—Ç–∫—É –æ–Ω–æ–≤–ª–µ–Ω–æ: ${updated.fullName}`);
                
                // –í–∏–¥–∞–ª–µ–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏
                await dataService.deleteCard(created.id);
                log(`‚úÖ –ö–∞—Ä—Ç–∫—É –≤–∏–¥–∞–ª–µ–Ω–æ: ${created.fullName}`);
                
                log('üéâ –û—Å–Ω–æ–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –ø—Ä–∞—Ü—é—é—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ!');
                
            } catch (error) {
                log(`‚ùå –ü–æ–º–∏–ª–∫–∞ –≤ –æ—Å–Ω–æ–≤–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ—è—Ö: ${error.message}`);
            }
        });

        document.getElementById('testArchive').addEventListener('click', async () => {
            log('=== –¢–ï–°–¢ –ê–†–•–Ü–í–£ ===');
            
            try {
                // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏ –¥–ª—è –∞—Ä—Ö—ñ–≤—É
                const archiveCard = {
                    fullName: `–ê—Ä—Ö—ñ–≤–Ω–∏–π –¢–µ—Å—Ç ${Date.now()}`,
                    ipn: '1111111111',
                    organization: '–ê—Ä—Ö—ñ–≤–Ω–∏–π –¢–µ—Å—Ç –û—Ä–≥',
                    accountOpenDate: '2025-07-01',
                    firstDepositDate: '2025-07-25',
                    cardStatus: '–í–∏–¥–∞–Ω–æ',
                    comment: '–¢–µ—Å—Ç –∞—Ä—Ö—ñ–≤—É',
                    documents: { contract: true, survey: true, passport: true }
                };
                
                const created = await dataService.addCard(archiveCard);
                log(`‚úÖ –ö–∞—Ä—Ç–∫—É –¥–ª—è –∞—Ä—Ö—ñ–≤—É —Å—Ç–≤–æ—Ä–µ–Ω–æ: ${created.fullName}`);
                
                // –ü–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è –≤ –∞—Ä—Ö—ñ–≤
                await dataService.moveToArchive(created);
                log(`‚úÖ –ö–∞—Ä—Ç–∫—É –ø–µ—Ä–µ–º—ñ—â–µ–Ω–æ –≤ –∞—Ä—Ö—ñ–≤: ${created.fullName}`);
                
                // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∞—Ä—Ö—ñ–≤—É
                const archived = await dataService.getArchivedCards();
                const archivedCard = archived.find(c => c.fullName === created.fullName);
                
                if (archivedCard) {
                    log(`‚úÖ –ö–∞—Ä—Ç–∫–∞ –∑–Ω–∞–π–¥–µ–Ω–∞ –≤ –∞—Ä—Ö—ñ–≤—ñ: ${archivedCard.fullName}`);
                    
                    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∞—Ä—Ö—ñ–≤–Ω–æ—ó –∫–∞—Ä—Ç–∫–∏
                    await dataService.updateArchivedCard(archivedCard.id, {
                        ...archivedCard,
                        comment: '–û–Ω–æ–≤–ª–µ–Ω–æ –≤ –∞—Ä—Ö—ñ–≤—ñ'
                    });
                    log(`‚úÖ –ê—Ä—Ö—ñ–≤–Ω—É –∫–∞—Ä—Ç–∫—É –æ–Ω–æ–≤–ª–µ–Ω–æ`);
                    
                    // –í–∏–¥–∞–ª–µ–Ω–Ω—è –∑ –∞—Ä—Ö—ñ–≤—É
                    await dataService.deleteArchivedCard(archivedCard.id);
                    log(`‚úÖ –ö–∞—Ä—Ç–∫—É –≤–∏–¥–∞–ª–µ–Ω–æ –∑ –∞—Ä—Ö—ñ–≤—É`);
                }
                
                log('üéâ –ê—Ä—Ö—ñ–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –ø—Ä–∞—Ü—é—é—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ!');
                
            } catch (error) {
                log(`‚ùå –ü–æ–º–∏–ª–∫–∞ –≤ –∞—Ä—Ö—ñ–≤–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ—è—Ö: ${error.message}`);
            }
        });

        document.getElementById('testCleanup').addEventListener('click', async () => {
            log('=== –û–ß–ò–©–ï–ù–ù–Ø –¢–ï–°–¢–û–í–ò–• –î–ê–ù–ò–• ===');
            
            try {
                let cleaned = 0;
                
                // –û—á–∏—â–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–∏—Ö –∫–∞—Ä—Ç–æ–∫
                const cards = await dataService.getCards();
                for (const card of cards) {
                    if (card.fullName.includes('–¢–µ—Å—Ç') || card.organization.includes('–¢–µ—Å—Ç')) {
                        await dataService.deleteCard(card.id);
                        cleaned++;
                        log(`üóëÔ∏è –í–∏–¥–∞–ª–µ–Ω–æ –∞–∫—Ç–∏–≤–Ω—É: ${card.fullName}`);
                    }
                }
                
                // –û—á–∏—â–µ–Ω–Ω—è –∞—Ä—Ö—ñ–≤–Ω–∏—Ö –∫–∞—Ä—Ç–æ–∫
                const archived = await dataService.getArchivedCards();
                for (const card of archived) {
                    if (card.fullName.includes('–¢–µ—Å—Ç') || card.organization.includes('–¢–µ—Å—Ç')) {
                        await dataService.deleteArchivedCard(card.id);
                        cleaned++;
                        log(`üóëÔ∏è –í–∏–¥–∞–ª–µ–Ω–æ –∞—Ä—Ö—ñ–≤–Ω—É: ${card.fullName}`);
                    }
                }
                
                log(`üßπ –û—á–∏—â–µ–Ω–æ ${cleaned} —Ç–µ—Å—Ç–æ–≤–∏—Ö –∫–∞—Ä—Ç–æ–∫`);
                
                // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É
                await init();
                
            } catch (error) {
                log(`‚ùå –ü–æ–º–∏–ª–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è: ${error.message}`);
            }
        });

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        init();
    </script>
</body>
</html>
