<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü©∫ –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º–∏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-50 p-4">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-2xl font-bold mb-6 text-center">ü©∫ –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º–∏</h1>
        
        <div class="space-y-4">
            <div class="bg-white rounded-lg shadow p-4">
                <h2 class="font-semibold mb-2">üìä –°—Ç–∞—Ç—É—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤</h2>
                <div id="diagnostics" class="space-y-2 text-sm">
                    <div>üîÑ –ü–µ—Ä–µ–≤—ñ—Ä—è—é...</div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow p-4">
                <h2 class="font-semibold mb-2">üîß –®–≤–∏–¥–∫–∏–π —Ç–µ—Å—Ç</h2>
                <button id="quickTest" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 text-sm">
                    –ü—Ä–æ–≤–µ—Å—Ç–∏ —à–≤–∏–¥–∫–∏–π —Ç–µ—Å—Ç
                </button>
                <div id="quickTestResult" class="mt-2 text-sm"></div>
            </div>
        </div>
    </div>

    <script src="supabaseConfig.js"></script>
    <script src="dataService.js"></script>
    
    <script>
        async function runDiagnostics() {
            const diagnosticsDiv = document.getElementById('diagnostics');
            const results = [];
            
            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ Supabase SDK
            if (typeof window.supabase !== 'undefined') {
                results.push('‚úÖ Supabase SDK –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ');
            } else {
                results.push('‚ùå Supabase SDK –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ');
            }
            
            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
            if (typeof SUPABASE_CONFIG !== 'undefined') {
                results.push('‚úÖ –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Supabase –¥–æ—Å—Ç—É–ø–Ω–∞');
                results.push(`üìä URL: ${SUPABASE_CONFIG.url}`);
                results.push(`üìä –¢–∞–±–ª–∏—Ü—ñ: ${Object.keys(SUPABASE_CONFIG.tables).join(', ')}`);
            } else {
                results.push('‚ùå –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Supabase –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞');
            }
            
            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó Supabase
            try {
                const isReady = initSupabase();
                if (isReady) {
                    results.push('‚úÖ Supabase –∫–ª—ñ—î–Ω—Ç —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ');
                } else {
                    results.push('‚ùå –ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó Supabase –∫–ª—ñ—î–Ω—Ç–∞');
                }
            } catch (error) {
                results.push(`‚ùå –ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó: ${error.message}`);
            }
            
            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ DataService
            try {
                const dataService = new DataService();
                results.push('‚úÖ DataService —Å—Ç–≤–æ—Ä–µ–Ω–æ');
                
                // –ß–µ–∫–∞—î–º–æ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                if (dataService.supabaseReady) {
                    results.push('‚úÖ DataService –≥–æ—Ç–æ–≤–∏–π –¥–æ —Ä–æ–±–æ—Ç–∏');
                } else {
                    results.push('‚ö†Ô∏è DataService —â–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î—Ç—å—Å—è...');
                }
            } catch (error) {
                results.push(`‚ùå –ü–æ–º–∏–ª–∫–∞ DataService: ${error.message}`);
            }
            
            diagnosticsDiv.innerHTML = results.map(r => `<div>${r}</div>`).join('');
        }
        
        document.getElementById('quickTest').addEventListener('click', async () => {
            const resultDiv = document.getElementById('quickTestResult');
            resultDiv.innerHTML = '<div class="text-blue-600">üîÑ –ü—Ä–æ–≤–æ–¥–∂—É —Ç–µ—Å—Ç...</div>';
            
            try {
                const dataService = new DataService();
                
                // –ß–µ–∫–∞—î–º–æ –≥–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å
                let attempts = 0;
                while (!dataService.supabaseReady && attempts < 10) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                    attempts++;
                }
                
                if (!dataService.supabaseReady) {
                    throw new Error('DataService –Ω–µ –≥–æ—Ç–æ–≤–∏–π –ø—ñ—Å–ª—è –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è');
                }
                
                // –¢–µ—Å—Ç—É—î–º–æ –æ—Å–Ω–æ–≤–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
                const cards = await dataService.getCards();
                const archivedCards = await dataService.getArchivedCards();
                
                resultDiv.innerHTML = `
                    <div class="text-green-600">
                        <div>‚úÖ –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ!</div>
                        <div>üìä –ê–∫—Ç–∏–≤–Ω–∏—Ö –∫–∞—Ä—Ç–æ–∫: ${cards.length}</div>
                        <div>üì¶ –ê—Ä—Ö—ñ–≤–Ω–∏—Ö –∫–∞—Ä—Ç–æ–∫: ${archivedCards.length}</div>
                        <div>‚è±Ô∏è –ß–∞—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ: ${Date.now() % 1000}–º—Å</div>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="text-red-600">‚ùå –¢–µ—Å—Ç –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–æ: ${error.message}</div>`;
            }
        });
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(runDiagnostics, 500);
        });
    </script>
</body>
</html>
